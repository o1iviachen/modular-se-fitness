# Plan: Convert Web App to iOS & Android Mobile Application

## Approach: Capacitor

**Why Capacitor?**
- Wraps existing React web app in native iOS/Android shell with minimal code changes
- Keep current stack (React, Vite, Firebase) as-is
- Single codebase for web + mobile
- Native API access via plugins (camera, push notifications, etc.)
- Active ecosystem with good Firebase integration

## Implementation Steps

### 1. Install Capacitor Core & CLI
**Files to modify:** `package.json`
- Add `@capacitor/core`, `@capacitor/cli`, `@capacitor/ios`, `@capacitor/android` as dependencies
- Add Capacitor scripts to package.json: `cap:init`, `cap:sync`, `cap:open:ios`, `cap:open:android`

### 2. Initialize Capacitor
**New files:** `capacitor.config.ts`
- Run `npx cap init` to create Capacitor config
- Configure app name: "SE Fitness"
- Configure app ID: "com.sefitness.app" (or user's preference)
- Set webDir: "dist" (Vite's build output)

### 3. Add iOS and Android Platforms
**New directories:** `ios/`, `android/`
- Run `npx cap add ios` to create native iOS project (Xcode workspace)
- Run `npx cap add android` to create native Android project (Gradle)

### 4. Update Vite Build Config
**Files to modify:** `vite.config.ts`
- Ensure base path is correct for mobile WebView
- Configure build to output to `dist/` (already done)
- Add proper public path handling

### 5. Add Required Capacitor Plugins
**Files to modify:** `package.json`, `capacitor.config.ts`

Install plugins:
- `@capacitor/camera` - for native camera/photo access (replaces web file input on mobile)
- `@capacitor/push-notifications` - for push notifications via FCM
- `@capacitor/splash-screen` - for native splash screen
- `@capacitor/status-bar` - for status bar styling
- `@capacitor/app` - for app lifecycle events
- `@capacitor/filesystem` - for photo storage if needed

### 6. Create Mobile-Specific Utilities
**New files:**
- `src/app/lib/capacitor.ts` - Capacitor platform detection and initialization
- `src/app/lib/cameraService.ts` - Wrapper for camera with fallback to web

**Logic:**
- Detect if running in native app vs web: `Capacitor.isNativePlatform()`
- Provide helpers to switch between native APIs and web APIs

### 7. Update Photo Upload Flow
**Files to modify:**
- `src/app/pages/athlete/AthleteEditProfile.tsx`
- `src/app/pages/coach/CoachEditProfile.tsx`

**Changes:**
- Add platform detection
- When on mobile: use `@capacitor/camera` plugin to access native camera/gallery
- When on web: keep existing `<input type="file">` approach
- Both paths upload to Firebase Storage (existing logic)

### 8. Add Push Notification Support
**Files to modify:**
- `src/app/lib/firebase.ts`
- `capacitor.config.ts` (add FCM config)

**New files:**
- `src/app/lib/pushNotifications.ts` - Handle FCM token registration and notification handlers

**Changes:**
- Initialize push notifications on app launch
- Request permission from user
- Register FCM token with Firebase
- Handle notification tap events
- Link to existing notification settings (already built)

### 9. Add App Icons and Splash Screen
**New files:**
- `resources/icon.png` - 1024x1024 app icon
- `resources/splash.png` - splash screen image
- Use `@capacitor/assets` CLI tool to generate all required sizes for iOS and Android

### 10. Configure iOS-Specific Settings
**Files to modify:** `ios/App/App/Info.plist`
- Add camera usage description: "SE Fitness needs access to your camera to upload profile photos"
- Add photo library usage description
- Configure app permissions
- Set Firebase GoogleService-Info.plist (download from Firebase console)

### 11. Configure Android-Specific Settings
**Files to modify:**
- `android/app/src/main/AndroidManifest.xml` - permissions and metadata
- `android/app/google-services.json` - Firebase config (download from console)

**Permissions to add:**
- Camera permission
- Storage permission
- Internet permission (already there)
- Push notification permission

### 12. Update Firebase Console for Mobile
**Actions in Firebase Console:**
- Register iOS app: bundle ID `com.sefitness.app`
- Register Android app: package name `com.sefitness.app`
- Download `GoogleService-Info.plist` for iOS
- Download `google-services.json` for Android
- Enable FCM (Firebase Cloud Messaging) for push notifications
- Add iOS APNs key/certificate for push notifications

### 13. Handle Mobile-Specific Routing
**Files to check:** `src/app/routes.tsx`
- Ensure all routes work with Capacitor's WebView
- Test deep linking if needed later
- Back button handling for Android (Capacitor provides this automatically)

### 14. Add Status Bar Styling
**New file:** `src/app/lib/statusBar.ts`
- Set status bar to black background with white text to match app header
- Handle safe area insets for iOS notch/island

### 15. Build and Sync Process
**Commands to document:**
```bash
# Build web assets
npm run build

# Sync to native projects
npx cap sync

# Open in Xcode (iOS)
npx cap open ios

# Open in Android Studio
npx cap open android
```

### 16. Testing Checklist
- [ ] App launches on iOS simulator
- [ ] App launches on Android emulator
- [ ] All routes navigate correctly
- [ ] Firebase Auth works (already uses web-based Firebase, should work as-is)
- [ ] Profile photo upload via camera works
- [ ] Profile photo upload via gallery works
- [ ] Push notifications register and receive
- [ ] Splash screen shows on launch
- [ ] Status bar styled correctly
- [ ] Back button works on Android
- [ ] App icon displays correctly

## Files That Will Be Created

**Core Capacitor:**
- `capacitor.config.ts` - main Capacitor configuration
- `ios/` - entire iOS native project (Xcode workspace)
- `android/` - entire Android native project (Gradle)

**App Resources:**
- `resources/icon.png` - 1024x1024 app icon
- `resources/splash.png` - splash screen

**New Source Files:**
- `src/app/lib/capacitor.ts` - platform detection utilities
- `src/app/lib/cameraService.ts` - camera abstraction for web/mobile
- `src/app/lib/pushNotifications.ts` - FCM push notification handling
- `src/app/lib/statusBar.ts` - status bar configuration

## Files That Will Be Modified

**Build Configuration:**
- `package.json` - add Capacitor dependencies and scripts
- `vite.config.ts` - ensure proper build output for mobile

**Photo Upload:**
- `src/app/pages/athlete/AthleteEditProfile.tsx` - use native camera on mobile
- `src/app/pages/coach/CoachEditProfile.tsx` - use native camera on mobile

**Firebase:**
- `src/app/lib/firebase.ts` - add push notification token registration

**iOS Native:**
- `ios/App/App/Info.plist` - permissions and descriptions
- `ios/App/App/GoogleService-Info.plist` - Firebase config (new file)

**Android Native:**
- `android/app/src/main/AndroidManifest.xml` - permissions
- `android/app/google-services.json` - Firebase config (new file)

## Dependencies to Install

```json
{
  "@capacitor/core": "^6.0.0",
  "@capacitor/cli": "^6.0.0",
  "@capacitor/ios": "^6.0.0",
  "@capacitor/android": "^6.0.0",
  "@capacitor/camera": "^6.0.0",
  "@capacitor/push-notifications": "^6.0.0",
  "@capacitor/splash-screen": "^6.0.0",
  "@capacitor/status-bar": "^6.0.0",
  "@capacitor/app": "^6.0.0"
}
```

## Important Notes

1. **Existing Firebase code works as-is** - Firebase JS SDK works in Capacitor WebView
2. **Keep web version working** - All changes use platform detection, web version unaffected
3. **Photos already upload to Firebase Storage** - just changing the input method (camera vs file input)
4. **Router already works** - react-router works in Capacitor WebView
5. **No UI rewrite needed** - All existing React components work unchanged

## Prerequisites for Building

**iOS:**
- macOS with Xcode 15+ installed
- iOS Simulator or physical iPhone for testing
- Apple Developer account (for TestFlight/App Store)

**Android:**
- Android Studio installed (Mac, Windows, or Linux)
- Android SDK and emulator set up
- Google Play Developer account (for Play Store)

## Post-Implementation

After initial setup:
1. Test on physical devices (not just simulators)
2. Setup app signing for iOS (Apple Developer)
3. Setup app signing for Android (Play Console)
4. Configure TestFlight for beta testing (iOS)
5. Configure internal testing track (Android)
6. Submit to App Store and Play Store when ready
